drop database if exists aopquickstart;
create database if not exists aopquickstart;
use aopquickstart;

-- ????????????????????ID?????????????
CREATE TABLE `users`
(
    `id`       INT AUTO_INCREMENT PRIMARY KEY, -- ???ID??????
    `username` VARCHAR(50)  NOT NULL,          -- ?????
    `password` VARCHAR(100) NOT NULL           -- ????
);

-- ????????????????????ID??????
CREATE TABLE `roles`
(
    `id`   INT AUTO_INCREMENT PRIMARY KEY, -- ???ID??????
    `name` VARCHAR(50) NOT NULL            -- ???????
);

-- ??????????????????ID???????????
CREATE TABLE `permissions`
(
    `id`          INT AUTO_INCREMENT PRIMARY KEY, -- ???ID??????
    `name`        VARCHAR(50) NOT NULL,           -- ???????
    `description` VARCHAR(255)                    -- ???????
);

-- ???????-???????????????????
CREATE TABLE `user_roles`
(
    `user_id` INT NOT NULL,                                              -- ???ID
    `role_id` INT NOT NULL,                                              -- ???ID
    PRIMARY KEY (`user_id`, `role_id`),                                  -- ???????????????????-????????
    FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE, -- ????????ID??????????????? users ????????????????????????????????????????????????????
    FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ON DELETE CASCADE  -- ????????ID??????????????? roles ????????????????????????????????????????????????????
);

-- ???????-???????????????????
CREATE TABLE `role_permissions`
(
    `role_id`       INT NOT NULL,                                                   -- ???ID
    `permission_id` INT NOT NULL,                                                   -- ???ID
    PRIMARY KEY (`role_id`, `permission_id`),                                       -- ???????????????????-????????
    FOREIGN KEY (`role_id`) REFERENCES `roles` (`id`) ON DELETE CASCADE,            -- ????????ID??????????????? roles ????????????????????????????????????????????????????
    FOREIGN KEY (`permission_id`) REFERENCES `permissions` (`id`) ON DELETE CASCADE -- ????????ID??????????????? permissions ????????????????????????????????????????????????????
);

-- ????????????????
INSERT INTO `users` (`username`, `password`)
VALUES ('alice', 'password1'),   -- ??? alice
       ('bob', 'password2'),     -- ??? bob
       ('charlie', 'password3'), -- ??? charlie
       ('david', 'password4'),   -- ??? david
       ('eve', 'password5');
-- ??? eve

-- ????????????????
INSERT INTO `roles` (`name`)
VALUES ('ADMIN'),     -- ????????
       ('USER'),      -- ?????????
       ('MODERATOR'), -- ???????
       ('GUEST');
-- ?????

-- ????????????????
INSERT INTO `permissions` (`name`, `description`)
VALUES ('READ_PRIVILEGES', 'Can read data'),     -- ??????
       ('WRITE_PRIVILEGES', 'Can write data'),   -- ??????
       ('DELETE_PRIVILEGES', 'Can delete data'), -- ??????
       ('UPDATE_PRIVILEGES', 'Can update data');
-- ???????

-- ??????????
INSERT INTO `user_roles` (`user_id`, `role_id`)
VALUES (1, 1), -- ?????ID?1???????alice??????????ID?1??????ADMIN??
       (2, 2), -- ?????ID?2???????bob??????????ID?2??????USER??
       (3, 3), -- ?????ID?3???????charlie??????????ID?3??????MODERATOR??
       (4, 4), -- ?????ID?4???????david??????????ID?4??????GUEST??
       (5, 2);
-- ?????ID?5???????eve??????????ID?2??????USER??

-- ???????????
# ADMIN ???????????????????????????
# USER ?????????
# MODERATOR ?????????????
# GUEST ?????????
INSERT INTO `role_permissions` (`role_id`, `permission_id`)
VALUES (1, 1), -- ?????ID?1??????ADMIN?????????ID?1??????READ_PRIVILEGES??
       (1, 2), -- ?????ID?1??????ADMIN?????????ID?2??????WRITE_PRIVILEGES??
       (1, 3), -- ?????ID?1??????ADMIN?????????ID?3??????DELETE_PRIVILEGES??
       (1, 4), -- ?????ID?1??????ADMIN?????????ID?4??????UPDATE_PRIVILEGES??
       (2, 1), -- ?????ID?2??????USER?????????ID?1??????READ_PRIVILEGES??
       (3, 1), -- ?????ID?3??????MODERATOR?????????ID?1??????READ_PRIVILEGES??
       (3, 4), -- ?????ID?3??????MODERATOR?????????ID?4??????UPDATE_PRIVILEGES??
       (4, 1); -- ?????ID?4??????GUEST?????????ID?1??????READ_PRIVILEGES??